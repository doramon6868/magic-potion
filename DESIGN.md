# Magic Potion / 魔法药水 - 产品设计文档

> **文档版本**: 1.0
> **最后更新**: 2026-02-20
> **文档状态**: 初版完成，与代码实现同步

---

## 目录

1. [产品概述](#第一部分产品概述)
2. [游戏系统](#第二部分游戏系统)
3. [交互设计](#第三部分交互设计)
4. [数值设计](#第四部分数值设计)
5. [版本规划](#第五部分版本规划)
6. [技术实现](#第六部分技术实现)
7. [附录](#第七部分附录)

---

## 第一部分：产品概述

### 1.1 游戏简介

#### 一句话描述
《魔法药水》是一款以紫色水晶球为核心交互载体的轻度宠物养成游戏，玩家通过拖拽操作喂养、训练和陪伴一只独特的"蛞蝓猫"宠物。

#### 核心玩法
- **拖拽交互**：所有操作都通过拖拽完成，极简操作门槛
- **双区域探索**：安全的森林玩耍区 vs 高风险的游猎战斗区
- **魔法主题**：水晶球作为连接内外世界的魔法 portal

#### 目标用户
- 主要受众：12-25岁女性玩家（可爱风格、低压力玩法）
- 次要受众：前端开发初学者（作为 Vue 3 学习项目）

### 1.2 核心循环（Core Loop）

```
┌─────────────────────────────────────────────────────────────┐
│                        核心游戏循环                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌──────────┐     喂养      ┌──────────┐     派遣          │
│   │  水晶球   │ ◄─────────── │  背包    │ ◄────────┐        │
│   │  (家园)   │              │ (道具)   │          │        │
│   └────┬─────┘              └──────────┘          │        │
│        ▲                                          │        │
│        │         ┌──────────────────────────────┐ │        │
│        │         │                              │ │        │
│        └─────────┤    森林区/游猎区 (户外)       │◄┘        │
│           召回   │    - 获得金币/经验            │          │
│                  │    - 提升心情                 │          │
│                  └──────────────────────────────┘          │
│                              │                             │
│                              ▼                             │
│                  ┌──────────────────────────┐              │
│                  │      商店消费             │              │
│                  │  购买食物 → 维持宠物生存   │              │
│                  └──────────────────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 留存机制
| 机制 | 说明 |
|------|------|
| 属性衰减 | 饱食度/心情随时间自然下降，驱动玩家定期回访 |
| 死亡风险 | 游猎区10%死亡概率制造紧张感和成就感 |
| 升级系统 | 经验值积累带来长期成长目标 |

### 1.3 游戏特色

#### 与竞品的差异化
| 维度 | 传统宠物游戏 | Magic Potion |
|------|-------------|--------------|
| 交互方式 | 点击按钮 | 拖拽操作 |
| 世界观 | 直接互动 | 水晶球作为媒介 |
| 风险设计 | 无死亡或惩罚很轻 | 10%死亡几率 |
| 美术风格 | 写实或卡通 | 紫色魔法主题 |

#### 核心卖点
1. **独特的蛞蝓猫形象** - 蜗牛+猫的奇趣组合
2. **水晶球魔法洞** - 所有交互通过旋涡 portal 完成
3. **极简拖拽操作** - 零学习成本

---

## 第二部分：游戏系统

### 2.1 宠物系统

#### 2.1.1 属性定义

| 属性 | 类型 | 范围 | 说明 |
|------|------|------|------|
| `hunger` | 数值 | 0-100 | 饱食度，低于30显示"饥饿"状态 |
| `mood` | 数值 | 0-100 | 心情，低于20显示"难过"状态 |
| `health` | 数值 | 0-100 | 健康值，战斗中死亡时归0 |
| `level` | 整数 | 1+ | 等级，每100经验升1级 |
| `experience` | 整数 | 0+ | 经验值，通过玩耍/战斗获得 |
| `status` | 枚举 | 见下表 | 当前状态 |
| `isAtHome` | 布尔 | true/false | 是否在水晶球内 |

#### 2.1.2 状态机定义

```
                    ┌─────────────┐
         ┌─────────│   idle      │◄──────────────┐
         │         │  (发呆)     │               │
         │         └──────┬──────┘               │
         │                │                       │
    饱食度<20             │ 喂食成功              │
         │                ▼                       │
         ▼         ┌─────────────┐               │
┌─────────────┐    │   eating    │               │
│    tired    │◄───│  (进食中)   │────┐          │
│  (疲惫)     │    └─────────────┘    │          │
└─────────────┘         │ 3秒后       │          │
                        ▼             │          │
              ┌─────────────┐         │          │
         ┌───▶│   happy     │─────────┘          │
         │    │  (开心)     │                     │
         │    └─────────────┘                     │
         │                                        │
   心情<20                                        │
         │                                        │
         ▼                                        │
┌─────────────┐                                   │
│     sad     │───────────────────────────────────┘
│  (难过)     │     被召回/自动结束
└─────────────┘

户外状态（独立分支）：
- playing: 在森林区玩耍
- hunting: 在游猎区战斗
```

#### 2.1.3 状态对应效果

| 状态 | 触发条件 | 视觉效果 | 属性影响 |
|------|---------|---------|---------|
| `idle` | 默认状态 | 无特殊动画 | 无 |
| `eating` | 开始喂食 | 旋涡特效 | +饱食度，+5心情 |
| `happy` | 喂食后3秒 | 跳跃动画 | 无 |
| `sleeping` | 规划中 | 摇摆动画 | 规划中 |
| `tired` | 饱食度<20 | 呼吸动画（缩放） | 无 |
| `sad` | 心情<20 | 无特殊动画 | 无 |
| `playing` | 派遣到森林 | 摇摆动画 | +10心情/3秒，+10经验 |
| `hunting` | 派遣到游猎 | 抖动动画 | 50-100金币或死亡 |

### 2.2 经济系统

#### 2.2.1 货币类型

| 货币 | 初始值 | 用途 | 获取方式 |
|------|--------|------|---------|
| 金币 | 100 | 购买物品 | 战斗奖励 |

#### 2.2.2 收支平衡表

**收入来源**
| 来源 | 金额范围 | 频率 | 风险 |
|------|---------|------|------|
| 游猎胜利 | 50-100 | 5秒/次 | 10%死亡 |
| 初始资金 | 100 | 一次性 | 无 |

**支出去向**
| 商品 | 价格 | 效果 | 性价比 |
|------|------|------|--------|
| 魔法饼干 | 10 | +20饱食度 | 2.0/金币 |
| 彩虹糖果 | 15 | +15饱食度 | 1.0/金币 |
| 魔法蛋糕 | 30 | +40饱食度 | 1.33/金币 |
| 星光果 | 25 | +30饱食度 | 1.2/金币 |
| 彩虹药水 | 50 | +50饱食度 | 1.0/金币 |
| 复活药水 | 100 | 复活宠物 | - |

#### 2.2.3 通货膨胀控制
- 固定价格商店，无供需波动
- 单次战斗收益可购买 1-2 个高级食物
- 需3-5次战斗才能购买复活药水（风险缓冲）

### 2.3 物品系统

#### 2.3.1 物品分类

| 类别 | ID | 名称 | 图标 | 效果 |
|------|----|------|------|------|
| 普通食物 | 1 | 魔法饼干 | 🍪 | +20饱食度 |
| 普通食物 | 2 | 彩虹糖果 | 🍬 | +15饱食度，+5心情 |
| 高级食物 | 3 | 魔法蛋糕 | 🍰 | +40饱食度 |
| 高级食物 | 4 | 星光果 | 🍎 | +30饱食度 |
| 顶级食物 | 5 | 彩虹药水 | 🧪 | +50饱食度 |
| 特殊道具 | 6 | 复活药水 | 💖 | 复活死亡宠物 |

#### 2.3.2 背包机制
- 初始物品：魔法饼干×3，彩虹糖果×2
- 堆叠上限：无限制（代码层面）
- 使用方式：拖拽到水晶球

### 2.4 战斗系统

#### 2.4.1 战斗规则

```javascript
// 战斗结果计算（outdoor.js:177）
const isDead = Math.random() < 0.1  // 10% 死亡概率

if (isDead) {
  health = 0
  status = 'tired'
  需要复活药水
} else {
  reward = Math.floor(Math.random() * 51) + 50  // 50-100金币
  experience += 25
}
```

#### 2.4.2 风险与收益

| 区域 | 风险 | 时间 | 奖励 | 经验 |
|------|------|------|------|------|
| 森林区 | 无 | 3秒 | +10心情 | +10 |
| 游猎区 | 10%死亡 | 5秒 | 50-100金币 | +25 |

#### 2.4.3 死亡惩罚
- 宠物健康值归0
- 状态变为`tired`
- 需要购买并使用复活药水（100金币）
- 未实现：等级下降、经验损失

### 2.5 合成系统（规划中）

#### 2.5.1 设计草案
| 配方 | 材料 | 成功率 | 产物 |
|------|------|--------|------|
| 初级合成 | 碎片×3 + 普通药水 | 70% | 随机1级宠物 |
| 高级合成 | 碎片×5 + 高级药水 | 50% | 随机2级宠物 |
| 稀有合成 | 碎片×10 + 稀有药水 | 30% | 稀有宠物 |

---

## 第三部分：交互设计

### 3.1 核心交互

#### 3.1.1 拖拽操作规范

| 操作 | 起点 | 终点 | 触发动作 | 视觉反馈 |
|------|------|------|---------|---------|
| 喂养 | 背包物品 | 水晶球 | 喂食宠物 | 旋涡出现，物品消失 |
| 外出玩耍 | 宠物 | 森林区 | 开始玩耍 | 宠物飞入旋涡 |
| 外出战斗 | 宠物 | 游猎区 | 开始战斗 | 宠物飞入旋涡 |
| 召回 | 户外宠物 | 水晶球 | 召回宠物 | 旋涡出现，宠物出现 |

#### 3.1.2 水晶球交互流程

```
拖拽物品进入水晶球区域
    │
    ▼
触发 @dragenter ────────► 显示旋涡特效 + 高亮边框
    │
    ▼
在区域内移动 ────────────► 旋涡持续旋转
    │
    ▼
释放物品 @drop ─────────► 解析拖拽数据
    │
    ├── 物品类型 ───────► 调用 feedPet()
    │                       - 检查宠物在家
    │                       - 检查饱食度未满
    │                       - 移除背包物品
    │                       - 增加饱食度/心情
    │                       - 3秒后恢复idle
    │
    └── 宠物类型 ───────► 调用 recallPet()
                            - 设置isAtHome=true
                            - 设置status='idle'
```

### 3.2 界面结构

#### 3.2.1 布局说明

```
┌──────────────────────────────────────────────────────────┐
│  TopBar (高度: 60px)                                      │
│  ┌──────────┬──────────────────────┬────────────────┐   │
│  │ 💰 金币   │     游戏标题          │    🛒 商店按钮  │   │
│  │  100     │   Magic Potion       │               │   │
│  └──────────┴──────────────────────┴────────────────┘   │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  game-area (flex布局, gap: 20px)                         │
│  ┌─────────┐  ┌───────────────┐  ┌───────────────────┐  │
│  │Backpack │  │ CrystalBall   │  │   OutdoorWrapper  │  │
│  │(250px)  │  │   (flex: 1)   │  │     (220px)       │  │
│  │         │  │               │  │  ┌─────────────┐  │  │
│  │ 物品列表 │  │    ╭─────╮    │  │  │ OutdoorPlay │  │  │
│  │         │  │   ╱ 水晶球 ╲   │  │  │  (190px)    │  │  │
│  │ 🍪 x3   │  │  │  ╭───╮  │   │  │  │             │  │  │
│  │ 🍬 x2   │  │  │  │🐌│  │   │  │  └─────────────┘  │  │
│  │         │  │  │  ╰───╯  │   │  │  ┌─────────────┐  │  │
│  │         │  │   ╲ ═════╱   │  │  │ OutdoorHunt │  │  │
│  │         │  │    ╰─────╯    │  │  │  (190px)    │  │  │
│  │         │  │   [地毯底座]   │  │  │             │  │  │
│  └─────────┘  └───────────────┘  └───────────────────┘  │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

#### 3.2.2 响应式规则

| 断点 | 布局调整 |
|------|---------|
| > 1024px | 三栏布局（背包-水晶球-户外） |
| 768-1024px | 背包/户外区折叠为顶部快捷栏 |
| < 768px | 垂直堆叠，水晶球居中 |

### 3.3 动画规范

#### 3.3.1 动画时长表

| 动画 | 时长 | 缓动函数 | 说明 |
|------|------|---------|------|
| 旋涡层1旋转 | 3s | linear | 最外层，顺时针 |
| 旋涡层2旋转 | 2s | linear | 中层，逆时针 |
| 旋涡层3旋转 | 1s | linear | 内层，顺时针 |
| 中心脉动 | 0.8s | ease-in-out | 缩放0.8-1.2 |
| 粒子轨道 | 1-2s | linear | 围绕中心旋转 |
| 拖拽高亮 | 0.3s | ease | 放大+发光 |

#### 3.3.2 宠物状态动画

| 状态 | 动画 | 时长 | 效果 |
|------|------|------|------|
| `sleeping` | sway | 3s | 左右摇摆 ±5deg |
| `happy` | jump | 0.5s | 上下跳跃 -10px，放大1.1x |
| `playing` | wiggle | 0.3s | 快速摇摆 ±10deg |
| `hunting` | shake | 0.2s | 水平抖动 ±3px |
| `tired` | breathe | 2s | 缩放 0.95-1.0 |
| 默认 | earWiggle | 2s | 耳朵摆动 ±5deg |

#### 3.3.3 缓动函数定义

```css
/* 线性 - 用于旋转 */
linear

/* 平滑 - 用于状态变化 */
ease

/* 弹性 - 用于跳跃 */
ease-in-out

/* 自定义弹跳 */
cubic-bezier(0.68, -0.55, 0.265, 1.55)
```

---

## 第四部分：数值设计

### 4.1 属性数值表

| 属性 | 初始值 | 最大值 | 衰减速度(在家) | 衰减速度(户外) | 恢复方式 |
|------|--------|--------|---------------|---------------|---------|
| 饱食度 | 80 | 100 | -1/周期 | -2/周期 | 食物 |
| 心情 | 70 | 100 | -0.5/周期 | -1/周期 | 玩耍、喂食 |
| 健康 | 100 | 100 | 0 | 战斗死亡 | 复活药水 |
| 经验 | 0 | ∞ | - | - | 玩耍+10，战斗+25 |

### 4.2 经济数值表

| 商品 | 价格 | 饱食度恢复 | 心情恢复 | 性价比 | 推荐场景 |
|------|------|-----------|---------|--------|---------|
| 魔法饼干 | 10 | +20 | - | 2.0 | 日常喂养 |
| 彩虹糖果 | 15 | +15 | +5 | 1.33 | 心情低落时 |
| 星光果 | 25 | +30 | - | 1.2 | 中度饥饿 |
| 魔法蛋糕 | 30 | +40 | - | 1.33 | 高度饥饿 |
| 彩虹药水 | 50 | +50 | - | 1.0 | 紧急恢复 |
| 复活药水 | 100 | - | - | - | 死亡复活 |

### 4.3 战斗数值表

| 区域 | 风险 | 时间 | 金币奖励 | 经验 | 心情变化 |
|------|------|------|---------|------|---------|
| 森林区 | 0% | 3秒 | 0 | +10 | +10 |
| 游猎区 | 10% | 5秒 | 50-100 | +25 | 0 |

### 4.4 升级数值表

| 等级 | 所需经验 | 累计经验 | 属性加成(规划中) |
|------|---------|---------|-----------------|
| 1 | 0 | 0 | 基础值 |
| 2 | 100 | 100 | +5%全属性 |
| 3 | 100 | 200 | +10%全属性 |
| 4 | 100 | 300 | +15%全属性 |
| 5 | 100 | 400 | +20%全属性 |
| N | 100 | (N-1)×100 | +5%×(N-1) |

### 4.5 时间系统（规划中）

| 游戏内时间 | 现实时间 | 饱食度消耗 | 事件 |
|-----------|---------|-----------|------|
| 1天 | 24分钟 | -20 | 每日重置 |
| 1小时 | 1分钟 | -1 | 属性衰减周期 |

---

## 第五部分：版本规划

### 5.1 已完成功能（V1.0 MVP）✅

- [x] 项目架构：Vue 3 + Pinia + Vite
- [x] 水晶球核心组件
- [x] 宠物显示与状态系统
- [x] 拖拽交互系统
- [x] 魔法旋涡特效
- [x] 背包系统
- [x] 商店系统
- [x] 森林玩耍区
- [x] 游猎战斗区
- [x] 基础数值系统

### 5.2 近期规划（V1.1）- 体验优化

- [ ] **宠物升级系统** - 经验值转化为实际属性提升
- [ ] **存档功能** - localStorage 保存游戏进度
- [ ] **音效系统** - 喂养、战斗、升级音效
- [ ] **宠物飞入飞出动画** - Vue Transition 实现
- [ ] **物品吸入动画** - 食物被旋涡吸收的视觉效果

### 5.3 中期规划（V1.2）- 内容扩展

- [ ] **宠物合成系统** - 使用碎片合成新宠物
- [ ] **更多宠物种类** - 3-5种不同外观的宠物
- [ ] **时间系统** - 真实时间影响宠物状态
- [ ] **任务系统** - 每日任务引导玩家行为
- [ ] **更多食物种类** - 增加选择多样性

### 5.4 远期规划（V2.0）- 社交与深度

- [ ] **社交功能** - 访问好友的宠物
- [ ] **成就系统** - 游戏内成就收集
- [ ] **图鉴系统** - 已收集宠物展示
- [ ] **装饰系统** - 自定义水晶球外观
- [ ] **多语言支持** - 英文、日文等

---

## 第六部分：技术实现

### 6.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.4+ | 前端框架，Options API |
| Pinia | 2.1+ | 状态管理 |
| v-drag-drop | 4.0+ | 拖拽功能（已改为原生HTML5 Drag API） |
| Naive UI | 2.37+ | UI 组件库（弹窗、按钮） |
| Vite | 5.0+ | 构建工具 |

### 6.2 数据结构

#### 6.2.1 宠物数据（game.js）
```javascript
{
  name: '小紫',
  hunger: 80,        // 0-100
  mood: 70,          // 0-100
  health: 100,       // 0-100
  status: 'idle',    // 状态枚举
  isAtHome: true,    // 布尔
  level: 1,          // 整数
  experience: 0      // 整数
}
```

#### 6.2.2 物品数据（backpack.js / shop.js）
```javascript
{
  id: 1,
  name: '魔法饼干',
  icon: '🍪',
  price: 10,         // 仅商店
  foodValue: 20,     // 饱食度恢复值
  quantity: 3        // 仅背包
}
```

### 6.3 状态管理

#### 6.3.1 Store 分工

| Store | 职责 | 关键 State |
|-------|------|-----------|
| `game.js` | 核心游戏状态 | pet, money |
| `backpack.js` | 物品管理 | items[] |
| `shop.js` | 商品配置 | items[] |
| `outdoor.js` | 户外逻辑 | playingPet, huntingPet |

#### 6.3.2 跨 Store 调用

```javascript
// game.js 调用 backpack.js
import { useBackpackStore } from './backpack.js'
const backpackStore = useBackpackStore()
backpackStore.removeItem(item.id, 1)

// outdoor.js 调用 game.js
import { useGameStore } from './game.js'
const gameStore = useGameStore()
gameStore.earnMoney(reward)
```

### 6.4 性能考虑

| 方面 | 当前实现 | 优化建议 |
|------|---------|---------|
| 动画 | CSS @keyframes | 使用 GPU 加速的 transform |
| 拖拽 | HTML5 Native API | 考虑 touch 设备支持 |
| 状态更新 | 直接修改 | 批量更新使用 `store.$patch()` |
| 图片资源 | Emoji | 后续可能需要 Sprite 图 |

---

## 第七部分：附录

### 7.1 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 水晶球 | Crystal Ball | 宠物居住的魔法容器，核心交互区域 |
| 魔法洞 | Magic Hole | 水晶球表面的旋涡 portal |
| 魔法洞 | Vortex | 旋涡特效的视觉表现 |
| 蛞蝓猫 | Slugcat | 宠物形象（蜗牛+猫的组合） |
| 森林区 | Forest/Play | 安全的玩耍区域 |
| 游猎区 | Hunting Zone | 高风险的战斗区域 |

### 7.2 更新日志

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2026-02-20 | 1.0 | 初始文档创建，与代码实现同步 |

### 7.3 代码对应表

| 文档章节 | 对应代码文件 |
|---------|-------------|
| 宠物系统 | `src/stores/game.js` |
| 背包系统 | `src/stores/backpack.js` |
| 商店系统 | `src/stores/shop.js` |
| 户外系统 | `src/stores/outdoor.js` |
| 水晶球UI | `src/components/CrystalBall.vue` |
| 旋涡动画 | `src/components/MagicVortex.vue` |
| 宠物UI | `src/components/Pet.vue` |

### 7.4 参考资料

- [Vue 3 官方文档](https://cn.vuejs.org/)
- [Pinia 官方文档](https://pinia.vuejs.org/zh/)
- [Naive UI 文档](https://www.naiveui.com/)

---

## 文档维护说明

1. **同步更新** - 代码变更时同步更新本文档
2. **版本标记** - 新增/变更内容使用 `(v1.x)` 标记
3. **待确认项** - 规划中功能使用 `规划中` 标注
4. **反馈渠道** - 问题请提交到项目 Issues

---

*本设计文档由 Claude Code 根据项目代码自动生成*
*生成时间: 2026-02-20*
