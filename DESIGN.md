# Magic Potion / 魔法药水 - 产品设计文档

> **文档版本**: 2.0
> **最后更新**: 2026-02-21
> **文档状态**: 已更新，与代码实现同步（V2.0 道具系统）

---

## 目录

1. [产品概述](#第一部分产品概述)
2. [游戏系统](#第二部分游戏系统)
3. [交互设计](#第三部分交互设计)
4. [数值设计](#第四部分数值设计)
5. [版本规划](#第五部分版本规划)
6. [技术实现](#第六部分技术实现)
7. [附录](#第七部分附录)

---

## 第一部分：产品概述

### 1.1 游戏简介

#### 一句话描述
《魔法药水》是一款以紫色水晶球为核心交互载体的轻度宠物养成游戏，玩家通过拖拽操作喂养、训练和陪伴一只独特的"蛞蝓猫"宠物。

#### 核心玩法
- **拖拽交互**：所有操作都通过拖拽完成，极简操作门槛
- **双区域探索**：安全的森林玩耍区 vs 高风险的游猎战斗区
- **魔法主题**：水晶球作为连接内外世界的魔法 portal

#### 目标用户
- 主要受众：12-25岁女性玩家（可爱风格、低压力玩法）
- 次要受众：前端开发初学者（作为 Vue 3 学习项目）

### 1.2 核心循环（Core Loop）

```
┌─────────────────────────────────────────────────────────────┐
│                        核心游戏循环                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌──────────┐     喂养      ┌──────────┐     派遣          │
│   │  水晶球   │ ◄─────────── │  背包    │ ◄────────┐        │
│   │  (家园)   │              │ (道具)   │          │        │
│   └────┬─────┘              └──────────┘          │        │
│        ▲                                          │        │
│        │         ┌──────────────────────────────┐ │        │
│        │         │                              │ │        │
│        └─────────┤    森林区/游猎区 (户外)       │◄┘        │
│           召回   │    - 获得金币/经验            │          │
│                  │    - 提升心情                 │          │
│                  └──────────────────────────────┘          │
│                              │                             │
│                              ▼                             │
│                  ┌──────────────────────────┐              │
│                  │      商店消费             │              │
│                  │  购买食物 → 维持宠物生存   │              │
│                  └──────────────────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 留存机制
| 机制 | 说明 |
|------|------|
| 属性衰减 | 饱食度/心情随时间自然下降，驱动玩家定期回访 |
| 死亡风险 | 游猎区10%死亡概率制造紧张感和成就感 |
| 升级系统 | 经验值积累带来长期成长目标 |

### 1.3 游戏特色

#### 与竞品的差异化
| 维度 | 传统宠物游戏 | Magic Potion |
|------|-------------|--------------|
| 交互方式 | 点击按钮 | 拖拽操作 |
| 世界观 | 直接互动 | 水晶球作为媒介 |
| 风险设计 | 无死亡或惩罚很轻 | 10%死亡几率 |
| 美术风格 | 写实或卡通 | 紫色魔法主题 |

#### 核心卖点
1. **独特的蛞蝓猫形象** - 蜗牛+猫的奇趣组合
2. **水晶球魔法洞** - 所有交互通过旋涡 portal 完成
3. **极简拖拽操作** - 零学习成本

---

## 第二部分：游戏系统

### 2.1 宠物系统

#### 2.1.1 属性定义

| 属性 | 类型 | 范围 | 说明 |
|------|------|------|------|
| `hunger` | 数值 | 0-100 | 饱食度，低于30显示"饥饿"状态 |
| `mood` | 数值 | 0-100 | 心情，低于20显示"难过"状态 |
| `health` | 数值 | 0-100 | 健康值，战斗中死亡时归0 |
| `level` | 整数 | 1+ | 等级，每100经验升1级 |
| `experience` | 整数 | 0+ | 经验值，通过玩耍/战斗获得 |
| `status` | 枚举 | 见下表 | 当前状态 |
| `isAtHome` | 布尔 | true/false | 是否在水晶球内 |
| `isDead` | 布尔 | true/false | 是否死亡（v2.0新增） |

#### 2.1.2 状态机定义

```
                    ┌─────────────┐
         ┌─────────│   idle      │◄──────────────┐
         │         │  (发呆)     │               │
         │         └──────┬──────┘               │
         │                │                       │
    饱食度<20             │ 喂食成功              │
         │                ▼                       │
         ▼         ┌─────────────┐               │
┌─────────────┐    │   eating    │               │
│    tired    │◄───│  (进食中)   │────┐          │
│  (疲惫)     │    └─────────────┘    │          │
└─────────────┘         │ 3秒后       │          │
                        ▼             │          │
              ┌─────────────┐         │          │
         ┌───▶│   happy     │─────────┘          │
         │    │  (开心)     │                     │
         │    └─────────────┘                     │
         │                                        │
   心情<20                                        │
         │                                        │
         ▼                                        │
┌─────────────┐                                   │
│     sad     │───────────────────────────────────┘
│  (难过)     │     被召回/自动结束
└─────────────┘

户外状态（独立分支）：
- playing: 在森林区玩耍
- hunting: 在游猎区战斗
```

#### 2.1.3 状态对应效果

| 状态 | 触发条件 | 视觉效果 | 属性影响 |
|------|---------|---------|---------|
| `idle` | 默认状态 | 无特殊动画 | 无 |
| `eating` | 开始喂食 | 旋涡特效 | +饱食度，+5心情 |
| `happy` | 喂食后3秒 | 跳跃动画 | 无 |
| `sleeping` | 规划中 | 摇摆动画 | 规划中 |
| `tired` | 饱食度<20 | 呼吸动画（缩放） | 无 |
| `sad` | 心情<20 | 无特殊动画 | 无 |
| `playing` | 派遣到森林 | 摇摆动画 | +10心情，+10经验 |
| `hunting` | 派遣到游猎 | 抖动动画 | 50-100金币，+25经验 |
| `dead` | 战斗死亡 | 无动画 | 需要复活药水 |

### 2.2 经济系统

#### 2.2.1 货币类型

| 货币 | 初始值 | 用途 | 获取方式 |
|------|--------|------|---------|
| 金币 | 100 | 购买物品 | 战斗奖励 |

#### 2.2.2 收支平衡表

**收入来源**
| 来源 | 金额范围 | 频率 | 风险 |
|------|---------|------|------|
| 游猎胜利 | 50-100 | 5秒/次 | 10%死亡（可降至5%） |
| 初始资金 | 100 | 一次性 | 无 |

**支出去向（v2.0 新价格体系）**
| 商品 | 价格 | 效果 | 性价比 | 稀有度 |
|------|------|------|--------|--------|
| 清水 | 5 | +10饱食度 | 2.0/金币 | 普通 |
| 魔法饼干 | 10 | +20饱食度 | 2.0/金币 | 普通 |
| 彩虹糖果 | 12 | +15饱食度，+15心情 | 1.41/金币 | 普通 |
| 护身符 | 15 | 死亡保金币 | - | 稀有 |
| 急救包 | 20 | 低血自动恢复50 | - | 稀有 |
| 战斗口粮 | 18 | +15饱食度，战斗奖励+30% | 1.39/金币 | 优秀 |
| 体力药剂 | 22 | +20饱食度，饱食消耗-50% | 1.0/金币 | 普通 |
| 魔法蛋糕 | 25 | +40饱食度 | 0.8/金币 | 普通 |
| 快乐玩具 | 28 | +40心情 | 0.89/金币 | 优秀 |
| 彩虹药水 | 35 | +40饱食度，+20心情 | 0.98/金币 | 优秀 |
| 经验卷轴 | 45 | 下次经验×2 | - | 稀有 |
| 复活药水 | 60 | 复活宠物 | - | 史诗 |
| 幸运护符 | 80 | 死亡概率-5% | - | 史诗 |
| 时间沙漏 | 100 | 重置今日衰减 | - | 史诗 |

#### 2.2.3 通货膨胀控制
- 固定价格商店，无供需波动
- 单次战斗收益可购买 1-2 个高级食物
- 需3-5次战斗才能购买复活药水（风险缓冲）

### 2.3 物品系统（v2.0 扩展版）

#### 2.3.1 物品分类概览

物品系统从6种扩展到**15种道具**，分为四大类别：

| 分类 | 说明 | 道具示例 |
|------|------|---------|
| `food` | 恢复类道具 | 魔法饼干、彩虹药水 |
| `mood` | 心情类道具 | 快乐玩具 |
| `combat` | 战斗增益道具 | 战斗口粮、经验卷轴 |
| `charm` | 被动保护道具 | 护身符、急救包 |
| `special` | 特殊功能道具 | 复活药水、时间沙漏 |

#### 2.3.2 稀有度系统

| 稀有度 | 颜色 | 价格区间 | 道具数量 |
|--------|------|----------|----------|
| `common`（普通） | 灰色 | 5-25金 | 5个 |
| `uncommon`（优秀） | 绿色 | 18-35金 | 3个 |
| `rare`（稀有） | 蓝色 | 15-45金 | 3个 |
| `epic`（史诗） | 紫色 | 60-100金 | 4个 |

#### 2.3.3 完整道具列表

**普通品质（Common）**
| ID | 名称 | 图标 | 价格 | 饱食 | 心情 | 风味文本 |
|----|------|------|------|------|------|----------|
| 1 | 魔法饼干 | 🍪 | 10 | +20 | 0 | 散发着淡淡的薰衣草香味，是魔法学徒的日常口粮 |
| 2 | 彩虹糖果 | 🍬 | 12 | +15 | +15 | 七种颜色的糖果在舌尖跳跃，仿佛能尝到彩虹的味道 |
| 3 | 魔法蛋糕 | 🍰 | 25 | +40 | 0 | 用月光奶油和星光面粉烘焙而成，每一口都是甜蜜的魔法 |
| 9 | 体力药剂 | 💪 | 22 | +20 | 0 | 炼金术士的基础配方，红色的液体在瓶中微微发光 |
| 12 | 清水 | 💧 | 5 | +10 | 0 | 来自魔法泉眼的清泉，虽然普通但不可或缺 |

**优秀品质（Uncommon）**
| ID | 名称 | 图标 | 价格 | 效果 | 风味文本 |
|----|------|------|------|------|----------|
| 5 | 彩虹药水 | 🧪 | 35 | +40饱食，+20心情 | 七种魔法元素完美融合的产物，瓶中的液体不断变换着颜色 |
| 7 | 快乐玩具 | 🎾 | 28 | +40心情 | 注入欢乐咒语的魔法玩具，宠物见了会忍不住扑上去 |
| 8 | 战斗口粮 | ⚔️ | 18 | +15饱食，下次战斗+30%奖励 | 由勇气香料和力量草药制成，战士们出征前的必备之物 |

**稀有品质（Rare）**
| ID | 名称 | 图标 | 价格 | 效果 | 风味文本 |
|----|------|------|------|------|----------|
| 10 | 护身符 | 🛡️ | 15 | 死亡时保留全部金币 | 古老的守护咒语被封印在这枚符文之中，散发着温暖的光芒 |
| 11 | 急救包 | 🏥 | 20 | 健康<30时自动恢复50点 | 精灵医者精心调配的医疗包，打开时会飘出治愈的香气 |
| 13 | 经验卷轴 | 📜 | 45 | 下次经验×2 | 记载着古代智者的智慧，阅读时文字会发光并流入脑海 |

**史诗品质（Epic）**
| ID | 名称 | 图标 | 价格 | 效果 | 风味文本 |
|----|------|------|------|------|----------|
| 6 | 复活药水 | 💖 | 60 | 复活死亡宠物，恢复50-100健康 | 传说中凤凰的眼泪凝结而成，蕴含着重生的魔力 |
| 14 | 幸运护符 | 🍀 | 80 | 死亡概率从10%降至5% | 四叶草的精华被封印在水晶中，持有者能感受到命运的眷顾 |
| 15 | 时间沙漏 | ⏳ | 100 | 重置今日所有属性衰减 | 其中流淌的不是沙子，而是凝固的时间碎片 |

#### 2.3.4 使用时机限制

| 限制类型 | 说明 | 适用道具 |
|----------|------|----------|
| `always` | 随时可用 | 食物、复活药水 |
| `before_hunt` | 战斗前使用，生效一次 | 战斗口粮、经验卷轴 |
| `passive` | 被动触发 | 护身符、急救包、幸运护符 |
| `special` | 特殊时机 | 时间沙漏 |

#### 2.3.5 Buff系统

**Buff数据结构**
```javascript
{
  type: 'hunt_reward_boost',  // buff类型
  value: 0.3,                 // 效果数值
  duration: 1,                // 剩余次数
  name: '战斗口粮',            // 来源道具名
  icon: '⚔️'                  // 图标
}
```

**Buff类型表**
| Buff类型 | 效果 | 来源道具 |
|----------|------|----------|
| `hunt_reward_boost` | 战斗奖励加成 | 战斗口粮 |
| `hunger_cost_reduce` | 探险饱食度消耗减少 | 体力药剂 |
| `death_money_protect` | 死亡保留金币 | 护身符 |
| `auto_heal` | 低血自动回血 | 急救包 |
| `exp_boost` | 经验值翻倍 | 经验卷轴 |
| `death_chance_reduce` | 死亡概率降低 | 幸运护符 |
| `reset_decay` | 重置属性衰减 | 时间沙漏 |

#### 2.3.6 背包机制
- 初始物品：魔法饼干×3，彩虹糖果×2，清水×2
- 堆叠上限：无限制
- 使用方式：拖拽到水晶球或使用Buff道具自动激活

#### 2.3.7 定价模型（v2.0）

基于价值功效的定价公式：
```
基础价格 = (饱食度 × 0.5) + (心情值 × 0.625) + (健康值 × 0.7)
最终价格 = 基础价格 × 稀有度系数 + 功能性调整
```

**稀有度系数**
| 稀有度 | 系数 |
|--------|------|
| 普通 | ×1.0 |
| 优秀 | ×1.1 |
| 稀有 | ×1.25 |
| 史诗 | ×1.5 |

### 2.4 战斗系统

#### 2.4.1 战斗规则

```javascript
// 战斗结果计算（outdoor.js）
// 基础死亡概率 10%，幸运护符可降低
let deathChance = 0.1
const deathReduceBuff = gameStore.consumeBuff('death_chance_reduce')
if (deathReduceBuff) {
  deathChance -= deathReduceBuff.value  // 降至 5%
}

const isDead = Math.random() < deathChance

if (isDead) {
  pet.isDead = true
  pet.health = 0
  pet.status = 'tired'
  // 检查死亡保护buff
  const moneyProtectBuff = gameStore.consumeBuff('death_money_protect')
} else {
  // 计算基础奖励（随机 50-100 金币）
  let reward = Math.floor(Math.random() * 51) + 50
  // 检查战斗奖励加成buff
  const rewardBuff = gameStore.consumeBuff('hunt_reward_boost')
  if (rewardBuff) {
    reward += Math.floor(reward * rewardBuff.value)
  }
  gameStore.earnMoney(reward)
  gameStore.addExperience(25)
}
```

#### 2.4.2 风险与收益

| 区域 | 风险 | 时间 | 金币奖励 | 经验 | 心情变化 |
|------|------|------|---------|------|---------|
| 森林区 | 0% | 3秒 | 0 | +10 | +10 |
| 游猎区 | 10%（可降至5%） | 5秒 | 50-100（+30%可能） | +25 | 0 |

#### 2.4.3 战斗过程机制

战斗过程中宠物会持续消耗属性：
- 每秒减少健康2点（5秒共减少10点）
- 每秒减少饱食度3点（战斗消耗体力）

#### 2.4.4 死亡惩罚
- 宠物`isDead`设为`true`
- 健康值归0，状态变为`tired`
- 无法外出玩耍或战斗
- 需要购买并使用复活药水（60金币）
- 复活后恢复健康50-100点，饱食度和心情恢复至50

#### 2.4.5 Buff在战斗中的应用

| Buff类型 | 触发时机 | 效果 |
|----------|----------|------|
| `death_chance_reduce` | 战斗结果计算前 | 降低死亡概率 |
| `hunt_reward_boost` | 战斗胜利后 | 增加金币奖励 |
| `exp_boost` | 获得经验时 | 经验值翻倍 |
| `death_money_protect` | 战斗死亡时 | 保留全部金币 |
| `auto_heal` | 战斗结束后健康<30 | 自动恢复50点健康 |

### 2.5 合成系统（规划中）

#### 2.5.1 设计草案
| 配方 | 材料 | 成功率 | 产物 |
|------|------|--------|------|
| 初级合成 | 碎片×3 + 普通药水 | 70% | 随机1级宠物 |
| 高级合成 | 碎片×5 + 高级药水 | 50% | 随机2级宠物 |
| 稀有合成 | 碎片×10 + 稀有药水 | 30% | 稀有宠物 |

---

## 第三部分：交互设计

### 3.1 核心交互

#### 3.1.1 拖拽操作规范

| 操作 | 起点 | 终点 | 触发动作 | 视觉反馈 |
|------|------|------|---------|---------|
| 喂养 | 背包物品 | 水晶球 | 喂食宠物 | 旋涡出现，物品消失 |
| 外出玩耍 | 宠物 | 森林区 | 开始玩耍 | 宠物飞入旋涡 |
| 外出战斗 | 宠物 | 游猎区 | 开始战斗 | 宠物飞入旋涡 |
| 召回 | 户外宠物 | 水晶球 | 召回宠物 | 旋涡出现，宠物出现 |

#### 3.1.2 水晶球交互流程

```
拖拽物品进入水晶球区域
    │
    ▼
触发 @dragenter ────────► 显示旋涡特效 + 高亮边框
    │
    ▼
在区域内移动 ────────────► 旋涡持续旋转
    │
    ▼
释放物品 @drop ─────────► 解析拖拽数据
    │
    ├── 物品类型 ───────► 调用 feedPet()
    │                       - 检查宠物在家
    │                       - 检查饱食度未满
    │                       - 移除背包物品
    │                       - 增加饱食度/心情
    │                       - 3秒后恢复idle
    │
    └── 宠物类型 ───────► 调用 recallPet()
                            - 设置isAtHome=true
                            - 设置status='idle'
```

### 3.2 界面结构

#### 3.2.1 布局说明

```
┌──────────────────────────────────────────────────────────┐
│  TopBar (高度: 60px)                                      │
│  ┌──────────┬──────────────────────┬────────────────┐   │
│  │ 💰 金币   │     游戏标题          │    🛒 商店按钮  │   │
│  │  100     │   Magic Potion       │               │   │
│  └──────────┴──────────────────────┴────────────────┘   │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  game-area (flex布局, gap: 20px)                         │
│  ┌─────────┐  ┌───────────────┐  ┌───────────────────┐  │
│  │Backpack │  │ CrystalBall   │  │   OutdoorWrapper  │  │
│  │(250px)  │  │   (flex: 1)   │  │     (220px)       │  │
│  │         │  │               │  │  ┌─────────────┐  │  │
│  │ 物品列表 │  │    ╭─────╮    │  │  │ OutdoorPlay │  │  │
│  │         │  │   ╱ 水晶球 ╲   │  │  │  (190px)    │  │  │
│  │ 🍪 x3   │  │  │  ╭───╮  │   │  │  │             │  │  │
│  │ 🍬 x2   │  │  │  │🐌│  │   │  │  └─────────────┘  │  │
│  │         │  │  │  ╰───╯  │   │  │  ┌─────────────┐  │  │
│  │         │  │   ╲ ═════╱   │  │  │ OutdoorHunt │  │  │
│  │         │  │    ╰─────╯    │  │  │  (190px)    │  │  │
│  │         │  │   [地毯底座]   │  │  │             │  │  │
│  └─────────┘  └───────────────┘  └───────────────────┘  │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

#### 3.2.2 响应式规则

| 断点 | 布局调整 |
|------|---------|
| > 1024px | 三栏布局（背包-水晶球-户外） |
| 768-1024px | 背包/户外区折叠为顶部快捷栏 |
| < 768px | 垂直堆叠，水晶球居中 |

### 3.3 动画规范

#### 3.3.1 动画时长表

| 动画 | 时长 | 缓动函数 | 说明 |
|------|------|---------|------|
| 旋涡层1旋转 | 3s | linear | 最外层，顺时针 |
| 旋涡层2旋转 | 2s | linear | 中层，逆时针 |
| 旋涡层3旋转 | 1s | linear | 内层，顺时针 |
| 中心脉动 | 0.8s | ease-in-out | 缩放0.8-1.2 |
| 粒子轨道 | 1-2s | linear | 围绕中心旋转 |
| 拖拽高亮 | 0.3s | ease | 放大+发光 |

#### 3.3.2 宠物状态动画

| 状态 | 动画 | 时长 | 效果 |
|------|------|------|------|
| `sleeping` | sway | 3s | 左右摇摆 ±5deg |
| `happy` | jump | 0.5s | 上下跳跃 -10px，放大1.1x |
| `playing` | wiggle | 0.3s | 快速摇摆 ±10deg |
| `hunting` | shake | 0.2s | 水平抖动 ±3px |
| `tired` | breathe | 2s | 缩放 0.95-1.0 |
| 默认 | earWiggle | 2s | 耳朵摆动 ±5deg |

#### 3.3.3 缓动函数定义

```css
/* 线性 - 用于旋转 */
linear

/* 平滑 - 用于状态变化 */
ease

/* 弹性 - 用于跳跃 */
ease-in-out

/* 自定义弹跳 */
cubic-bezier(0.68, -0.55, 0.265, 1.55)
```

---

## 第四部分：数值设计

### 4.1 属性数值表

| 属性 | 初始值 | 最大值 | 衰减速度(在家) | 衰减速度(户外) | 恢复方式 |
|------|--------|--------|---------------|---------------|---------|
| 饱食度 | 80 | 100 | -1/分钟 | -2/分钟 | 食物 |
| 心情 | 70 | 100 | -5/分钟 | -5/分钟 | 玩耍、玩具 |
| 健康 | 100 | 100 | 0 | 战斗-10 | 复活后50-100 |
| 经验 | 0 | ∞ | - | - | 玩耍+10，战斗+25 |
| 死亡状态 | false | - | - | - | 复活药水 |

### 4.2 经济数值表（v2.0 新价格）

| 商品 | 价格 | 饱食度恢复 | 心情恢复 | 性价比 | 推荐场景 | 稀有度 |
|------|------|-----------|---------|--------|---------|--------|
| 清水 | 5 | +10 | - | 2.0 | 最廉价补充 | 普通 |
| 魔法饼干 | 10 | +20 | - | 2.0 | 日常喂养 | 普通 |
| 彩虹糖果 | 12 | +15 | +15 | 1.41 | 双属性补充 | 普通 |
| 战斗口粮 | 18 | +15 | - | 1.39 | 战斗前使用 | 优秀 |
| 急救包 | 20 | - | - | - | 保险道具 | 稀有 |
| 体力药剂 | 22 | +20 | - | 1.0 | 长期探险 | 普通 |
| 魔法蛋糕 | 25 | +40 | - | 0.8 | 批量喂养 | 普通 |
| 快乐玩具 | 28 | - | +40 | 0.89 | 心情专精 | 优秀 |
| 彩虹药水 | 35 | +40 | +20 | 0.98 | 综合恢复 | 优秀 |
| 经验卷轴 | 45 | - | - | - | 冲级使用 | 稀有 |
| 护身符 | 15 | - | - | - | 死亡保险 | 稀有 |
| 复活药水 | 60 | - | - | - | 死亡复活 | 史诗 |
| 幸运护符 | 80 | - | - | - | 降低风险 | 史诗 |
| 时间沙漏 | 100 | - | - | - | 重置衰减 | 史诗 |

### 4.3 战斗数值表

| 区域 | 基础风险 | 最低风险 | 时间 | 金币奖励 | 经验 | 心情变化 |
|------|----------|----------|------|---------|------|---------|
| 森林区 | 0% | 0% | 3秒 | 0 | +10 | +10 |
| 游猎区 | 10% | 5% | 5秒 | 50-100 | +25 | 0 |

**风险调整**
- 使用幸运护符：死亡概率从10%降至5%
- 使用护身符：死亡时保留全部金币

### 4.4 Buff效果数值表

| Buff类型 | 效果数值 | 持续次数 | 触发条件 |
|----------|----------|----------|----------|
| `hunt_reward_boost` | +30% | 1次战斗 | 主动使用战斗口粮 |
| `hunger_cost_reduce` | -50% | 1次探险 | 主动使用体力药剂 |
| `exp_boost` | ×2 | 1次获得 | 主动使用经验卷轴 |
| `death_chance_reduce` | -5% | 1天 | 主动使用幸运护符 |
| `death_money_protect` | 100%保留 | 1次死亡 | 被动触发（护身符） |
| `auto_heal` | +50健康 | 1次触发 | 被动触发，健康<30（急救包） |
| `reset_decay` | 全恢复 | 立即 | 主动使用时间沙漏 |

### 4.5 升级数值表

| 等级 | 所需经验 | 累计经验 | 说明 |
|------|---------|---------|------|
| 1 | 0 | 0 | 初始等级 |
| 2 | 100 | 100 | 首次升级 |
| 3 | 100 | 200 | 成长中 |
| 4 | 100 | 300 | 进阶 |
| 5 | 100 | 400 | 专家 |
| N | 100 | (N-1)×100 | 每级100经验 |

**经验获取来源**
- 森林玩耍：+10经验
- 游猎战斗：+25经验（经验卷轴可翻倍）

### 4.6 存档系统数值

| 参数 | 数值 | 说明 |
|------|------|------|
| 自动保存间隔 | 60秒 | 默认设置，可调整（最少10秒） |
| 手动存档槽位 | 3个 | 0-2号槽位 |
| 离线属性衰减 | 与在线相同 | 饱食度-1/分钟（在家），-2/分钟（户外） |
| 离线心情衰减 | 5点/分钟 | 与在线时一致 |

### 4.7 时间系统（规划中）

| 游戏内时间 | 现实时间 | 饱食度消耗 | 事件 |
|-----------|---------|-----------|------|
| 1天 | 24分钟 | -20 | 每日重置 |
| 1小时 | 1分钟 | -1 | 属性衰减周期 |

---

## 第五部分：版本规划

### 5.1 已完成功能（V1.0 MVP）✅

- [x] 项目架构：Vue 3 + Pinia + Vite
- [x] 水晶球核心组件
- [x] 宠物显示与状态系统
- [x] 拖拽交互系统
- [x] 魔法旋涡特效
- [x] 背包系统
- [x] 商店系统
- [x] 森林玩耍区
- [x] 游猎战斗区
- [x] 基础数值系统
- [x] **存档系统** - localStorage 自动保存+3个手动槽位
- [x] **Buff系统** - 6种道具增益效果
- [x] **通知系统** - 底部通知栏替代alert
- [x] **死亡机制** - isDead字段和复活流程

### 5.2 已完成功能（V2.0）- 道具系统扩展

- [x] **道具数量扩展** - 从6种增加到15种
- [x] **稀有度系统** - common/uncommon/rare/epic 四级
- [x] **价格体系重平衡** - 基于价值功效定价模型
- [x] **新增道具** - 清水、经验卷轴、幸运护符、时间沙漏
- [x] **使用时机限制** - always/before_hunt/passive/special
- [x] **存档版本控制** - saveVersion.js 版本迁移

### 5.3 近期规划（V1.1）- 体验优化

- [ ] **宠物升级系统** - 经验值转化为实际属性提升
- [ ] **音效系统** - 喂养、战斗、升级音效
- [ ] **宠物飞入飞出动画** - Vue Transition 实现
- [ ] **物品吸入动画** - 食物被旋涡吸收的视觉效果

### 5.4 中期规划（V1.2）- 内容扩展

- [ ] **宠物合成系统** - 使用碎片合成新宠物
- [ ] **更多宠物种类** - 3-5种不同外观的宠物
- [ ] **时间系统** - 真实时间影响宠物状态
- [ ] **任务系统** - 每日任务引导玩家行为

### 5.5 远期规划（V2.1）- 社交与深度

- [ ] **社交功能** - 访问好友的宠物
- [ ] **成就系统** - 游戏内成就收集
- [ ] **图鉴系统** - 已收集宠物展示
- [ ] **装饰系统** - 自定义水晶球外观
- [ ] **多语言支持** - 英文、日文等

---

## 第六部分：技术实现

### 6.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.4+ | 前端框架，Options API |
| Pinia | 2.1+ | 状态管理 |
| v-drag-drop | 4.0+ | 拖拽功能（已改为原生HTML5 Drag API） |
| Naive UI | 2.37+ | UI 组件库（弹窗、按钮） |
| Vite | 5.0+ | 构建工具 |

### 6.2 数据结构

#### 6.2.1 宠物数据（game.js）
```javascript
{
  name: '小紫',
  hunger: 80,        // 0-100
  mood: 70,          // 0-100
  health: 100,       // 0-100
  status: 'idle',    // 状态枚举
  isAtHome: true,    // 布尔
  isDead: false,     // 布尔（v2.0新增）
  level: 1,          // 整数
  experience: 0      // 整数
}
```

#### 6.2.2 物品数据（backpack.js / shop.js）
```javascript
{
  id: 1,
  name: '魔法饼干',
  icon: '🍪',
  category: 'food',           // 分类（v2.0新增）
  rarity: 'common',           // 稀有度（v2.0新增）
  price: 10,                  // 仅商店
  foodValue: 20,              // 饱食度恢复值
  moodValue: 0,               // 心情恢复值
  description: '恢复少量饱食度',
  flavorText: '散发着淡淡的薰衣草香味...',  // 风味文本（v2.0新增）
  useCondition: 'always',     // 使用时机（v2.0新增）
  buff: null,                 // 增益效果（v2.0新增）
  quantity: 3                 // 仅背包
}
```

#### 6.2.3 Buff数据（game.js）
```javascript
// activeBuffs 数组中的元素
{
  type: 'hunt_reward_boost',  // buff类型
  value: 0.3,                 // 效果数值
  duration: 1,                // 剩余次数
  name: '战斗口粮',            // 来源道具名
  icon: '⚔️'                  // 图标
}
```

### 6.3 状态管理

#### 6.3.1 Store 分工

| Store | 职责 | 关键 State |
|-------|------|-----------|
| `game.js` | 核心游戏状态 | pet, money, activeBuffs |
| `backpack.js` | 物品管理 | items[] |
| `shop.js` | 商品配置 | items[] |
| `outdoor.js` | 户外逻辑 | playingPet, huntingPet |
| `save.js` | 存档管理 | saveList, currentSlotIndex |
| `notification.js` | 通知系统 | notifications[] |
| `saveVersion.js` | 存档版本 | CURRENT_SAVE_VERSION |

#### 6.3.2 存档系统

**存档数据结构**
```javascript
{
  meta: {
    id: 'save_xxx',
    name: '存档 1',
    version: 1,           // 存档版本
    createdAt: 1234567890,
    updatedAt: 1234567890,
    playTime: 120         // 游戏时长（分钟）
  },
  game: {
    money: 100,
    gameTime: 120,
    pet: { ... },
    activeBuffs: [ ... ]
  },
  backpack: {
    items: [ ... ]
  },
  outdoor: {
    playingPet: null,
    huntingPet: null,
    playStartTime: null,
    huntStartTime: null
  }
}
```

**存档版本控制**
- 当前版本：`CURRENT_SAVE_VERSION = 1`
- 自动迁移：`migrateSaveIfNeeded()` 自动升级旧版本存档
- 版本历史记录在 `SAVE_VERSION_HISTORY` 中

#### 6.3.3 跨 Store 调用

```javascript
// game.js 调用 backpack.js
import { useBackpackStore } from './backpack.js'
const backpackStore = useBackpackStore()
backpackStore.removeItem(item.id, 1)

// outdoor.js 调用 game.js
import { useGameStore } from './game.js'
const gameStore = useGameStore()
gameStore.earnMoney(reward)
```

### 6.4 性能考虑

| 方面 | 当前实现 | 优化建议 |
|------|---------|---------|
| 动画 | CSS @keyframes | 使用 GPU 加速的 transform |
| 拖拽 | HTML5 Native API | 考虑 touch 设备支持 |
| 状态更新 | 直接修改 | 批量更新使用 `store.$patch()` |
| 图片资源 | Emoji | 后续可能需要 Sprite 图 |

---

## 第七部分：附录

### 7.1 术语表

| 术语 | 英文 | 说明 |
|------|------|------|
| 水晶球 | Crystal Ball | 宠物居住的魔法容器，核心交互区域 |
| 魔法洞 | Magic Hole | 水晶球表面的旋涡 portal |
| 魔法洞 | Vortex | 旋涡特效的视觉表现 |
| 蛞蝓猫 | Slugcat | 宠物形象（蜗牛+猫的组合） |
| 森林区 | Forest/Play | 安全的玩耍区域 |
| 游猎区 | Hunting Zone | 高风险的战斗区域 |

### 7.2 更新日志

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2026-02-20 | 1.0 | 初始文档创建，与代码实现同步 |
| 2026-02-21 | 2.0 | 物品系统扩展（15种道具）、价格体系重平衡、存档系统、Buff系统、通知系统、死亡机制 |

### 7.3 代码对应表

| 文档章节 | 对应代码文件 |
|---------|-------------|
| 宠物系统 | `src/stores/game.js` |
| 背包系统 | `src/stores/backpack.js` |
| 商店系统 | `src/stores/shop.js` |
| 户外系统 | `src/stores/outdoor.js` |
| 存档系统 | `src/stores/save.js` |
| 通知系统 | `src/stores/notification.js` |
| 存档版本控制 | `src/stores/saveVersion.js` |
| 游戏平衡配置 | `src/config/gameBalance.js` |
| 水晶球UI | `src/components/CrystalBall.vue` |
| 旋涡动画 | `src/components/MagicVortex.vue` |
| 宠物UI | `src/components/Pet.vue` |
| 物品UI | `src/components/Item.vue` |
| Buff状态显示 | `src/components/BuffStatus.vue` |
| 通知栏 | `src/components/NotificationBar.vue` |
| 存档管理器 | `src/components/SaveManager.vue` |

### 7.4 新增设计文档

| 文档 | 说明 |
|------|------|
| `docs/ITEM_SYSTEM_DESIGN.md` | 道具系统V2.0设计方案 |
| `docs/PRICE_UPDATE_SUMMARY.md` | 价格更新总结 |

### 7.5 参考资料

- [Vue 3 官方文档](https://cn.vuejs.org/)
- [Pinia 官方文档](https://pinia.vuejs.org/zh/)
- [Naive UI 文档](https://www.naiveui.com/)

---

## 文档维护说明

1. **同步更新** - 代码变更时同步更新本文档
2. **版本标记** - 新增/变更内容使用 `(v2.x)` 标记
3. **待确认项** - 规划中功能使用 `规划中` 标注
4. **反馈渠道** - 问题请提交到项目 Issues

---

*本设计文档由 Claude Code 根据项目代码自动生成*
*生成时间: 2026-02-21*
*文档版本: 2.0*
